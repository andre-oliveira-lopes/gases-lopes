<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gases Uni√£o - Pedidos Especiais</title>
    <link rel="stylesheet" href="../assets/css/main.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- Top Bar -->
      <header class="topbar">
        <div class="topbar__left">
          <!-- Vazio por enquanto -->
        </div>
        <div class="topbar__right">
          <button class="topbar__menu-btn" aria-label="Menu de op√ß√µes">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <button class="topbar__exit-btn">Sair</button>
          <div class="topbar__user">
            <img
              src="../assets/images/my-face.png"
              alt="Avatar do usu√°rio"
              class="topbar__avatar"
            />
            <button class="topbar__dropdown-btn" aria-label="Menu do usu√°rio">
              <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                <path
                  d="M1 1L6 6L11 1"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
            </button>
          </div>
        </div>
      </header>

      <!-- Container do conte√∫do (Sidebar + Conte√∫do) -->
      <div class="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
          <!-- Header da Sidebar -->
          <div class="sidebar__header">
            <h1 class="sidebar__title">Gases Uni√£o app</h1>
          </div>

          <!-- Menu de Atividades -->
          <nav class="sidebar__nav">
            <h2 class="sidebar__section-title">Atividades</h2>
            <ul class="sidebar__menu">
              <li class="sidebar__menu-item">
                <a href="../index.html" class="sidebar__link">
                  <img
                    src="../assets/icons/inicio.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>In√≠cio</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="buscar.html" class="sidebar__link">
                  <img
                    src="../assets/icons/buscar-icone.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Buscar</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="nota-entrega.html" class="sidebar__link">
                  <img
                    src="../assets/icons/nota-de-entrega-icone.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Nota de Entrega</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="nota-emprestimo.html" class="sidebar__link">
                  <img
                    src="../assets/icons/nota-de-emprestimo.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Nota de Emprestimo</span>
                </a>
              </li>
              <li class="sidebar__menu-item sidebar__menu-item--active">
                <a href="pedidos-especiais.html" class="sidebar__link">
                  <img
                    src="../assets/icons/pedidos-especiais-icone.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Pedidos Especiais</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="fornecedor.html" class="sidebar__link">
                  <img
                    src="../assets/icons/fornecedor-icones.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Fornecedor</span>
                </a>
              </li>
            </ul>

            <!-- Menu de Informa√ß√µes -->
            <h2 class="sidebar__section-title">Informa√ß√µes</h2>
            <ul class="sidebar__menu">
              <li class="sidebar__menu-item">
                <a href="tabela-precos.html" class="sidebar__link">
                  <img
                    src="../assets/icons/tabela-de-preco-icone.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Tabela de Pre√ßos</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="dados-cilindros.html" class="sidebar__link">
                  <img
                    src="../assets/icons/info-icones.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Dados dos Cilindros</span>
                </a>
              </li>
              <li class="sidebar__menu-item">
                <a href="dashboard.html" class="sidebar__link">
                  <img
                    src="../assets/icons/dashboard-icone.svg"
                    alt=""
                    class="sidebar__icon"
                  />
                  <span>Dashboard</span>
                </a>
              </li>
            </ul>
          </nav>
        </aside>

        <!-- √Årea de Conte√∫do Principal -->
        <main class="content">
          <!-- SUBSTITUA ESTE CONTE√öDO PELO CONTE√öDO ESPEC√çFICO DA SUA P√ÅGINA -->

          <h1>Pedidos Especiais</h1>
          <p>Conte√∫do da p√°gina aqui...</p>

          <!-- FIM DO CONTE√öDO -->
        </main>
      </div>
    </div>

    <script src="../assets/js/navigation.js"></script>

    <!-- Importar os UTILS (formatadores e validadores) -->
    <script src="../assets/js/utils/formatters.js"></script>
    <script src="../assets/js/utils/validators.js"></script>
        
        <!-- IMPORTA A API DE PEDIDOS -->
        <script src="../assets/js/api/pedidos.js"></script>
        
        <!-- MODAL DE EDI√á√ÉO -->
        <div id="modalEditar" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚úèÔ∏è Editar Pedido</h2>
                    <button class="close-btn" onclick="fecharModal()">&times;</button>
                </div>
                <form id="formEditarPedido" onsubmit="salvarEdicao(event)">
                    <input type="hidden" id="edit_id">
                    
                    <div class="form-group">
                        <label for="edit_descricao">Descri√ß√£o: *</label>
                        <input type="text" id="edit_descricao" required>
                    </div>

                    <div class="form-group">
                        <label for="edit_quantidade">Quantidade: *</label>
                        <input type="number" id="edit_quantidade" min="1" required>
                    </div>

                    <div class="form-group">
                        <label for="edit_valor">Valor Total (R$):</label>
                        <input type="number" step="0.01" id="edit_valor">
                    </div>

                    <div class="form-group">
                        <label for="edit_status">Status:</label>
                        <select id="edit_status">
                            <option value="pendente">‚è≥ Pendente</option>
                            <option value="aprovado">‚úÖ Aprovado</option>
                            <option value="entregue">üì¶ Entregue</option>
                            <option value="cancelado">‚ùå Cancelado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="edit_fornecedor">Fornecedor:</label>
                        <select id="edit_fornecedor">
                            <option value="">Selecione...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="edit_data_entrega">Data de Entrega:</label>
                        <input type="date" id="edit_data_entrega">
                    </div>

                    <div class="form-group">
                        <label for="edit_observacoes">Observa√ß√µes:</label>
                        <textarea id="edit_observacoes" rows="3"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SEU C√ìDIGO QUE USA A API -->
        <script>
            // Quando a p√°gina carregar
            document.addEventListener('DOMContentLoaded', async () => {
                await carregarPedidos();
                await carregarFornecedoresNoModal();
            });

            // ============================================
            // CARREGAR FORNECEDORES NO SELECT DO MODAL
            // ============================================
            async function carregarFornecedoresNoModal() {
                try {
                    const { ipcRenderer } = require('electron');
                    const fornecedores = await ipcRenderer.invoke('fornecedores:listar');
                    
                    const select = document.getElementById('edit_fornecedor');
                    select.innerHTML = '<option value="">Selecione...</option>';
                    
                    fornecedores.forEach(f => {
                        const option = document.createElement('option');
                        option.value = f.id;
                        option.textContent = f.nome;
                        select.appendChild(option);
                    });
                } catch (error) {
                    console.error('Erro ao carregar fornecedores:', error);
                }
            }

            // ============================================
            // CARREGAR E EXIBIR PEDIDOS
            // ============================================
            async function carregarPedidos() {
                try {
                    const pedidos = await PedidosAPI.listar();
                    
                    console.log(`üìã ${pedidos.length} pedidos encontrados`);
                    
                    const container = document.querySelector('.content');
                    
                    if (pedidos.length === 0) {
                        container.innerHTML = `
                            <h1>Pedidos Especiais</h1>
                            <p>Nenhum pedido cadastrado ainda.</p>
                        `;
                        return;
                    }
                    
                    container.innerHTML = '<h1>üìã Pedidos Cadastrados</h1>';
                    
                    pedidos.forEach(pedido => {
                        const card = document.createElement('div');
                        card.className = 'pedido-card';
                        card.style.cssText = 'background: white; border: 1px solid #ddd; padding: 20px; margin: 10px 0; border-radius: 8px;';
                        
                        card.innerHTML = `
                            <h3>${pedido.descricao}</h3>
                            <p><strong>Quantidade:</strong> ${pedido.quantidade}</p>
                            <p><strong>Valor:</strong> ${formatarDinheiro(pedido.valor_total)}</p>
                            <p><strong>Status:</strong> ${formatarStatus(pedido.status)}</p>
                            ${pedido.fornecedor_nome ? `<p><strong>Fornecedor:</strong> ${pedido.fornecedor_nome}</p>` : ''}
                            ${pedido.data_entrega ? `<p><strong>Entrega:</strong> ${formatarData(pedido.data_entrega)}</p>` : ''}
                            ${pedido.observacoes ? `<p><strong>Obs:</strong> ${pedido.observacoes}</p>` : ''}
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button onclick="abrirModalEditar(${pedido.id})" class="btn btn-edit">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button onclick="deletarPedido(${pedido.id})" class="btn btn-danger">
                                    üóëÔ∏è Deletar
                                </button>
                            </div>
                        `;
                        
                        container.appendChild(card);
                    });
                    
                } catch (error) {
                    console.error('Erro:', error);
                    alert(error.message);
                }
            }

            // ============================================
            // ABRIR MODAL DE EDI√á√ÉO
            // ============================================
            async function abrirModalEditar(id) {
                try {
                    // Busca os dados do pedido
                    const pedido = await PedidosAPI.buscar(id);
                    
                    if (!pedido) {
                        alert('‚ùå Pedido n√£o encontrado!');
                        return;
                    }

                    // Preenche o formul√°rio
                    document.getElementById('edit_id').value = pedido.id;
                    document.getElementById('edit_descricao').value = pedido.descricao;
                    document.getElementById('edit_quantidade').value = pedido.quantidade;
                    document.getElementById('edit_valor').value = pedido.valor_total || '';
                    document.getElementById('edit_status').value = pedido.status;
                    document.getElementById('edit_fornecedor').value = pedido.fornecedor_id || '';
                    document.getElementById('edit_data_entrega').value = pedido.data_entrega || '';
                    document.getElementById('edit_observacoes').value = pedido.observacoes || '';

                    // Mostra o modal
                    document.getElementById('modalEditar').classList.add('show');
                } catch (error) {
                    console.error('Erro ao abrir modal:', error);
                    alert('‚ùå Erro ao carregar dados do pedido!');
                }
            }

            // ============================================
            // FECHAR MODAL
            // ============================================
            function fecharModal() {
                document.getElementById('modalEditar').classList.remove('show');
                document.getElementById('formEditarPedido').reset();
            }

            // Fechar modal ao clicar fora
            document.getElementById('modalEditar').addEventListener('click', function(e) {
                if (e.target === this) {
                    fecharModal();
                }
            });

            // ============================================
            // SALVAR EDI√á√ÉO
            // ============================================
            async function salvarEdicao(event) {
                event.preventDefault();

                const id = parseInt(document.getElementById('edit_id').value);
                const dados = {
                    descricao: document.getElementById('edit_descricao').value,
                    quantidade: parseInt(document.getElementById('edit_quantidade').value),
                    valor_total: parseFloat(document.getElementById('edit_valor').value) || null,
                    status: document.getElementById('edit_status').value,
                    fornecedor_id: parseInt(document.getElementById('edit_fornecedor').value) || null,
                    data_entrega: document.getElementById('edit_data_entrega').value || null,
                    observacoes: document.getElementById('edit_observacoes').value || null
                };

                try {
                    await PedidosAPI.atualizar(id, dados);
                    alert('‚úÖ Pedido atualizado com sucesso!');
                    fecharModal();
                    await carregarPedidos();
                } catch (error) {
                    alert('‚ùå Erro ao atualizar pedido: ' + error.message);
                }
            }

            // ============================================
            // DELETAR PEDIDO
            // ============================================
            async function deletarPedido(id) {
                if (confirm('Tem certeza que deseja deletar este pedido?')) {
                    try {
                        await PedidosAPI.deletar(id);
                        alert('‚úÖ Pedido deletado com sucesso!');
                        await carregarPedidos();
                    } catch (error) {
                        alert(error.message);
                    }
                }
            }
        </script>

    </body>
    </html>
  </body>
</html>
